<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="/static/layui/layui.js"  type="text/javascript"></script>
    <script src="/static/js/publicUtils.js" type="text/javascript"></script>
    <script src="/static/js/common.js" type="text/javascript"></script>
    <link href="/static/layui/css/layui.css" rel="stylesheet">
    <title >菜单列表</title>
    <style>
       .main-body{
           padding: 18px;
       }
    </style>
</head>
<body class="main-body">
<form class="layui-form" action="/user/dosave" id="dataForm" >
    <input type="hidden" name="id" th:value="${data?.id}">

    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">用户名</label>
            <div class="layui-input-inline" >
                <input type="text" th:name="name"   th:value="${data?.name}" autocomplete="off" class="layui-input" lay-verify="required" >
            </div>
        </div>
    </div>

    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">用户账号</label>
            <div class="layui-input-inline" >
                <input type="text" th:name="loginId" lay-verify="required"  th:value="${data?.loginId}" autocomplete="off" class="layui-input" maxlength="16" oninput="this.value=this.value.replace(/[^\da-zA-Z]/g,'')" onproperty="this.value=this.value.replace(/[^\da-zA-Z]/g,'')">
            </div>
        </div>
    </div>

    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">手机号</label>
            <div class="layui-input-inline" >
                <input type="text" th:name="mobilePhone"   th:value="${data?.mobilePhone}" autocomplete="off" class="layui-input" >
            </div>
        </div>
    </div>

    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">昵称</label>
            <div class="layui-input-inline" >
                <input type="text" th:name="nickeName"   th:value="${data?.nickeName}" autocomplete="off" class="layui-input" >
            </div>
        </div>
    </div>


    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">电子邮件</label>
            <div class="layui-input-inline" >
                <input type="text" th:name="email"   th:value="${data?.email}" autocomplete="off" class="layui-input" >
            </div>
        </div>
    </div>


    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">头像</label>
            <div class="layui-input-inline" >
                <input type="text" th:name="headImg"   th:value="${data?.headImg}" autocomplete="off" class="layui-input" >
            </div>
        </div>
    </div>

    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-inline">
                <input type="text"  th:lay-verify="${data?.id == null?required:'' }" th:readOnly="${data?.id != null }" id="password" th:name="password"   autocomplete="off" class="layui-input" oninput="this.value=this.value.replace(/[^\w]/g,'')" onproperty="this.value=this.value.replace(/[^\w]/g,'')" maxlength="16">

            </div>
            <div class="layui-input-inline" >
                <button type="button" id="resetPassword" class="layui-btn layuiadmin-btn-list"  lay-filter="resetPassword">重置密码</button>
            </div>

        </div>
    </div>

    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">用户类型</label>
            <div class="layui-input-inline">
                <select name="userType" lay-verify="required">
                    <option value="ORDINARY" th:selected="${data?.userType?.value == 'ORDINARY'}">普通用户</option>
                    <option th:if="${currUserType?.value == 'ADMIN' || currUserType?.value == 'SUPER_ADMIN'}" value="ADMIN" th:selected="${data?.userType?.value == 'ADMIN'}">普通管理员</option>
                    <option th:if="${currUserId == 1}" value="SUPER_ADMIN" th:selected="${data?.userType?.value == 'SUPER_ADMIN'}">超级管理员</option>
                </select>
            </div>

        </div>
    </div>

    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">应用</label>
            <div class="layui-input-inline">
                <input th:each="item:${apps}" lay-skin="primary" type="checkbox" name="appIds" th:value="${item.id}" th:title="${item.appName}" lay-filter="appIds" th:checked="${item.checked == true}?'checked'" >
            </div>

        </div>
    </div>



    <button id="save" type="button" class="layui-btn layuiadmin-btn-list"  lay-submit=""  lay-filter="save">保存</button>



</form>
</body>
<script type="text/javascript">
    let appids = '[[${data?.apps}]]';
    layui.use(['form','laydate'],function () {
         /* var laydate = layui.laydate;*/
          var form = layui.form;

          if(appids.length == 0){
              appids = new Set();
          }else{
              appids = new Set(JSON.parse(appids));
          }

       renderEdit('save','[[${lastLayId}]]');

       form.on('checkbox(appIds)',function (data) {
           //console.log(data.elem); //得到checkbox原始DOM对象
           let value =  data.elem.value;
           if(data.elem.checked){
             appids.add(value);
           }else{
               appids.delete(value);
           }
       })
    });


    function beforeSubmit(data){
        data.field.appIds = Array.from(appids).join(",");
        return true;
    }
    let numCharPool = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
    $(function () {
        $("#resetPassword").click(function () {
             let len = Math.round(Math.random()*8)+8;
             let newPassWord = "";
             for (let i =0;i<len;i++){
                newPassWord +=  numCharPool[Math.floor(Math.random()*62)];
             }
            $("#password").val(newPassWord).change();
        })

        $("#password").on('change',function () {
            document.execCommand('selectAll');
            document.execCommand('copy');
            layer.msg("密码已复制");
        })
    })
</script>
</html>