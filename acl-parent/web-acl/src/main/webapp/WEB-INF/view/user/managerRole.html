<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="/static/js/jquery-3.5.1.min.js"></script>
    <script src="/static/layui/layui.js"  type="text/javascript"></script>
    <script src="/static/js/publicUtils.js" type="text/javascript"></script>
    <script src="/static/js/common.js" type="text/javascript"></script>
    <link href="/static/layui/css/layui.css" rel="stylesheet">
    <title >菜单列表</title>
    <style>
        .main-body{
            padding: 18px;
        }
    </style>
</head>
<body class="main-body">
<form class="layui-form" action="/user/saveRoles" id="dataForm" >
    <input type="hidden" name="id" th:value="${user?.id}">
    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">角色名</label>
            <div class="layui-input-inline" >
                <input type="text" th:value="${user?.name}"  readonly  autocomplete="off" class="layui-input" >
            </div>
        </div>
    </div>


    <div class="layui-form-item query-form-item">
        <div class="layui-collapse">

                    <div th:each="item:${apps}" class="layui-colla-item">
                        <h2 class="layui-colla-title" th:text="${item.appName}"></h2>
                        <div class="layui-colla-content layui-show">
                            <input th:each="role:${item.roles}" type="checkbox" name="roleIds" th:title="${role.name}" th:value="${role.id}" lay-skin="primary" lay-filter="roleIds" th:checked="${role.checked == true}?'checked'">
                    </div>
        </div>
    </div>


    <div class="layui-form-item query-form-item">
        <div class="layui-inline">
            <button id="save" class="layui-btn layuiadmin-btn-list" lay-submit  lay-filter="save">保存</button>
        </div>
    </div>

</form>
</body>
<script type="text/javascript">
    let roleIds = '[[${roleIds}]]';
    layui.use(['form','laydate'],function () {
        /* var laydate = layui.laydate;*/
        var form = layui.form;

        if(roleIds.length == 0){
            roleIds = new Set();
        }else{
            roleIds = new Set(JSON.parse(roleIds));
        }
        renderEdit('save','[[${lastLayId}]]');
        form.on('checkbox(roleIds)',function (data) {
            //console.log(data.elem); //得到checkbox原始DOM对象
            let value =  data.elem.value;
            if(data.elem.checked){
                roleIds.add(value);
            }else{
                roleIds.delete(value);
            }
        })
    });

    function beforeSubmit(data){
        data.field.roleIds = Array.from(roleIds);
        return true;
    }
</script>
</html>